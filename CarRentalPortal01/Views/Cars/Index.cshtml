@model IEnumerable<CarRentalPortal01.Models.Vehicle>

@{
    ViewData["Title"] = "Araçları Filtrele";
    Layout = "~/Views/Shared/_UserLayout.cshtml";
}

<section class="hero-wrap hero-wrap-2 js-fullheight" style="background-image: url('/Frontend/images/bg_3.jpg');" data-stellar-background-ratio="0.5">
    <div class="overlay"></div>
    <div class="container">
        <div class="row no-gutters slider-text js-fullheight align-items-end justify-content-start">
            <div class="col-md-9 ftco-animate pb-5">
                <p class="breadcrumbs">
                    <span class="mr-2"><a href="/Home/Index">Anasayfa <i class="ion-ios-arrow-forward"></i></a></span>
                    <span>Araçlar <i class="ion-ios-arrow-forward"></i></span>
                </p>
                <h1 class="mb-3 bread">Tüm Araçlar</h1>
            </div>
        </div>
    </div>
</section>

<section class="ftco-section bg-light">
    <div class="container">
        <div class="row">

            <div class="col-md-3">
                <div class="sidebar-box bg-white p-4 ftco-animate shadow-sm rounded">
                    <h3 class="heading mb-4">Filtrele</h3>

                    <form asp-controller="Cars" asp-action="Index" method="get">

                        <div class="form-group">
                            <label class="font-weight-bold">Kelime Ara</label>
                            <input type="text" name="search" class="form-control" placeholder="Örn: BMW" value="@ViewBag.CurrentSearch">
                        </div>

                        <div class="form-group">
                            <label class="font-weight-bold">Kategori</label>
                            <select name="categoryId" class="form-control">
                                <option value="">Tümü</option>
                                @foreach (var cat in (List<CarRentalPortal01.Models.Category>)ViewBag.Categories)
                                {
                                    if (ViewBag.CurrentCategory == cat.Id)
                                    {
                                        <option value="@cat.Id" selected>@cat.Name</option>
                                    }
                                    else
                                    {
                                        <option value="@cat.Id">@cat.Name</option>
                                    }
                                }
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="font-weight-bold">Günlük Fiyat (TL)</label>
                            <div class="d-flex">
                                <input type="number" name="minPrice" class="form-control mr-1" placeholder="Min" value="@ViewBag.MinPrice">
                                <input type="number" name="maxPrice" class="form-control ml-1" placeholder="Max" value="@ViewBag.MaxPrice">
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="font-weight-bold">Marka</label>
                            <select name="brand" class="form-control">
                                <option value="">Tüm Markalar</option>
                                @foreach (var b in (List<string>)ViewBag.Brands)
                                {
                                    if (ViewBag.CurrentBrand == b)
                                    {
                                        <option value="@b" selected>@b</option>
                                    }
                                    else
                                    {
                                        <option value="@b">@b</option>
                                    }
                                }
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="font-weight-bold">Model Yılı</label>
                            <div class="d-flex">
                                <input type="number" name="minYear" class="form-control mr-1" placeholder="Min" value="@ViewBag.MinYear">
                                <input type="number" name="maxYear" class="form-control ml-1" placeholder="Max" value="@ViewBag.MaxYear">
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="font-weight-bold">Vites</label>
                            <select name="gearType" class="form-control">
                                <option value="">Farketmez</option>
                                @if (ViewBag.CurrentGear == "Manuel")
                                {
                                    <option value="Manuel" selected>Manuel</option>
                                }
                                else
                                {
                                    <option value="Manuel">Manuel</option>
                                }
                                @if (ViewBag.CurrentGear == "Otomatik")
                                {
                                    <option value="Otomatik" selected>Otomatik</option>
                                }
                                else
                                {
                                    <option value="Otomatik">Otomatik</option>
                                }
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="font-weight-bold">Yakıt</label>
                            <select name="fuelType" class="form-control">
                                <option value="">Farketmez</option>
                                @if (ViewBag.CurrentFuel == "Benzin")
                                {
                                    <option value="Benzin" selected>Benzin</option>
                                }
                                else
                                {
                                    <option value="Benzin">Benzin</option>
                                }
                                @if (ViewBag.CurrentFuel == "Dizel")
                                {
                                    <option value="Dizel" selected>Dizel</option>
                                }
                                else
                                {
                                    <option value="Dizel">Dizel</option>
                                }
                                @if (ViewBag.CurrentFuel == "Elektrik")
                                {
                                    <option value="Elektrik" selected>Elektrik</option>
                                }
                                else
                                {
                                    <option value="Elektrik">Elektrik</option>
                                }
                                @if (ViewBag.CurrentFuel == "Hibrit")
                                {
                                    <option value="Hibrit" selected>Hibrit</option>
                                }
                                else
                                {
                                    <option value="Hibrit">Hibrit</option>
                                }
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="font-weight-bold">Renk</label>
                            <select name="color" class="form-control">
                                <option value="">Tümü</option>
                                @foreach (var c in (List<string>)ViewBag.Colors)
                                {
                                    if (ViewBag.CurrentColor == c)
                                    {
                                        <option value="@c" selected>@c</option>
                                    }
                                    else
                                    {
                                        <option value="@c">@c</option>
                                    }
                                }
                            </select>
                        </div>

                        <div class="form-group mt-4">
                            <button type="submit" class="btn btn-primary btn-block py-3">Sonuçları Göster</button>
                            <a href="/Cars/Index" class="btn btn-outline-secondary btn-block btn-sm mt-2">Temizle</a>
                        </div>

                    </form>
                </div>
            </div>

            <div class="col-md-9">
                <div class="row">
                    @if (Model != null && Model.Any())
                    {
                        @foreach (var car in Model)
                        {
                            <div class="col-md-4">
                                <div class="car-wrap rounded ftco-animate">
                                    <div class="img rounded d-flex align-items-end"
                                         style="background-image: url('/@car.ImageUrl');">
                                    </div>
                                    <div class="text">
                                        <h2 class="mb-0"><a href="/Cars/CarDetail/@car.Id">@car.Brand @car.Model</a></h2>
                                        <div class="d-flex mb-3">
                                            <span class="cat">@car.Year / @car.GearType</span>
                                            <p class="price ml-auto">@car.DailyRentalRate.ToString("C0") <span>/gün</span></p>
                                        </div>
                                        <p class="d-flex mb-0 d-block">
                                            <a asp-controller="Cars" asp-action="Details" asp-route-id="@car.Id" class="btn btn-secondary py-2 ml-1">Detaylar</a>

                                            <a asp-controller="Cars" asp-action="Rent" asp-route-id="@car.Id" class="btn btn-primary py-2 mr-1">Kirala</a>
                                        </p>
                                    </div>
                                </div>
                            </div>
                        }
                    }
                    else
                    {
                        <div class="col-12 text-center py-5">
                            <div class="alert alert-warning">
                                <h4>Aradığınız kriterlere uygun araç bulunamadı.</h4>
                                <p>Lütfen filtreleri değiştirerek tekrar deneyin.</p>
                            </div>
                        </div>
                    }
                </div>

                @if (ViewBag.TotalPages > 1)
                {
                    <div class="row mt-5">
                        <div class="col text-center">
                            <div class="block-27">
                                <ul>
                                    @{
                                        // Uzun link yapısını kısaltmak için query string'i değişkene alalım
                                        string filterParams = $"search={ViewBag.CurrentSearch}&categoryId={ViewBag.CurrentCategory}&brand={ViewBag.CurrentBrand}&minPrice={ViewBag.MinPrice}&maxPrice={ViewBag.MaxPrice}&minYear={ViewBag.MinYear}&maxYear={ViewBag.MaxYear}&gearType={ViewBag.CurrentGear}&fuelType={ViewBag.CurrentFuel}&color={ViewBag.CurrentColor}";
                                    }

                                    @if (ViewBag.CurrentPage > 1)
                                    {
                                        <li><a href="/Cars/Index?page=@(ViewBag.CurrentPage - 1)&@filterParams">&lt;</a></li>
                                    }

                                    @for (int i = 1; i <= ViewBag.TotalPages; i++)
                                    {
                                        <li class="@(i == ViewBag.CurrentPage ? "active" : "")">
                                            <a href="/Cars/Index?page=@i&@filterParams">@i</a>
                                        </li>
                                    }

                                    @if (ViewBag.CurrentPage < ViewBag.TotalPages)
                                    {
                                        <li><a href="/Cars/Index?page=@(ViewBag.CurrentPage + 1)&@filterParams">&gt;</a></li>
                                    }
                                </ul>
                            </div>
                        </div>
                    </div>
                }
            </div>

        </div>
    </div>
</section>